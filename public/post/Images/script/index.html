<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Chris&#39;s Data Blog  | Is it an Airplane or Automobile? Neural Network using Keras and Randomly Dowloaded Images from the Internet</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.49.2" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.e08a958ae3e530145318b6373195c765.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="Is it an Airplane or Automobile? Neural Network using Keras and Randomly Dowloaded Images from the Internet" />
<meta property="og:description" content="Image Classification - Keras by Chris Shockley" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/images/script/" /><meta property="article:published_time" content="2018-12-01T10:58:08-04:00"/>
<meta property="article:modified_time" content="2018-12-01T10:58:08-04:00"/>

<meta itemprop="name" content="Is it an Airplane or Automobile? Neural Network using Keras and Randomly Dowloaded Images from the Internet">
<meta itemprop="description" content="Image Classification - Keras by Chris Shockley">


<meta itemprop="datePublished" content="2018-12-01T10:58:08-04:00" />
<meta itemprop="dateModified" content="2018-12-01T10:58:08-04:00" />
<meta itemprop="wordCount" content="1036">



<meta itemprop="keywords" content="supervised learning,caret,machine learning,models,keras,tutorial,tensorflow," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Is it an Airplane or Automobile? Neural Network using Keras and Randomly Dowloaded Images from the Internet"/>
<meta name="twitter:description" content="Image Classification - Keras by Chris Shockley"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  
  
  <header class="cover bg-top" style="background-image: url('/images/airplane.jpeg');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      Chris&#39;s Data Blog
    </a>
    <div class="flex-l items-center">
      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/contact/" title="Contact page">
              Contact
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/post/" title="Posts page">
              Posts
            </a>
          </li>
          
        </ul>
      
      


  <a href="fb.me/astronomerforfun" class="link-transition facebook link dib z-999 pt3 pt0-l mr2" title="Facebook link">
    <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

  </a>








    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Is it an Airplane or Automobile? Neural Network using Keras and Randomly Dowloaded Images from the Internet</h1>
        
          <h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
            Image Classification - Keras by Chris Shockley
          </h2>
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  <article class="flex-l flex-wrap justify-between mw8 center ph3 ph0-l">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Is it an Airplane or Automobile? Neural Network using Keras and Randomly Dowloaded Images from the Internet</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2018-12-01T10:58:08-04:00">December 1, 2018</time>
    </header>

    <main class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><div id="image-classification" class="section level2">
<h2>Image Classification</h2>
<p>Objective: I wanted to see if I could build a Neural Network that could identify a Plane vs a Car. To do so I downloaded 12 pictures, 6 of which were airplanes and 6 that were cars. I then created the Network using Google Tensorflow and Keras Package to train the model. I then tested the model on two pictures. The results are below:</p>
<p>Methodology:</p>
<ol style="list-style-type: decimal">
<li>Download Pictures using ReadImages</li>
<li>Normalize Pictures since they are different sizes</li>
<li>Reshape Pictures for Model using array_reshape from Keras Package</li>
<li>Create Training Set and Training Labels/Create Test Set and Labels</li>
<li>Build Neural Network</li>
<li>Run the Model</li>
<li>Test model on never before seen pictures.</li>
</ol>
<div id="download-packages" class="section level4">
<h4>Download Packages</h4>
<p>EBImage is a package that reads in the JPEG’s and converts them to numeric values based on the image size.</p>
<pre class="r"><code>library(EBImage)
library(keras)</code></pre>
<pre><code>## 
## Attaching package: &#39;keras&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:EBImage&#39;:
## 
##     normalize</code></pre>
<p><br></p>
</div>
<div id="put-pictrues-into-a-vector" class="section level4">
<h4>Put Pictrues into a Vector</h4>
<p>I labeled the pictures with a p for airplane and c for car.</p>
<pre class="r"><code>pics &lt;- c(&quot;p1.JPEG&quot;, &quot;p2.JPEG&quot;,&quot;p3.JPEG&quot;, &quot;p4.JPEG&quot;, &quot;p5.JPEG&quot;, &quot;p6.JPEG&quot;,&quot;c1.JPEG&quot;, &quot;c2.JPEG&quot;, &quot;c3.JPEG&quot;, &quot;c4.JPEG&quot;, &quot;c5.JPEG&quot;, &quot;c6.JPEG&quot;)</code></pre>
<p><br></p>
</div>
<div id="read-in-the-pictures" class="section level4">
<h4>Read in the Pictures</h4>
<p>ReadImage is the function within the EBimage package that is needed to do this project. I have not found a comparison package.</p>
<pre class="r"><code>mypic &lt;- list()

for(i in 1:12){
  mypic[[i]] &lt;- readImage(pics[i])
}</code></pre>
<p><br></p>
</div>
<div id="look-at-image" class="section level4">
<h4>Look at Image</h4>
<p>The images are now converted to numerical data, which I can use to build the Network.</p>
<pre class="r"><code>print(mypic[[6]])</code></pre>
<pre><code>## Image 
##   colorMode    : Color 
##   storage.mode : double 
##   dim          : 275 183 3 
##   frames.total : 3 
##   frames.render: 1 
## 
## imageData(object)[1:5,1:6,1]
##           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
## [1,] 0.1019608 0.1019608 0.1019608 0.1019608 0.1019608 0.1019608
## [2,] 0.1058824 0.1058824 0.1058824 0.1058824 0.1058824 0.1058824
## [3,] 0.1058824 0.1058824 0.1058824 0.1058824 0.1058824 0.1058824
## [4,] 0.1058824 0.1058824 0.1058824 0.1058824 0.1058824 0.1058824
## [5,] 0.1098039 0.1098039 0.1098039 0.1098039 0.1098039 0.1098039</code></pre>
<p><br></p>
<pre class="r"><code>display(mypic[[6]])</code></pre>
<p><img src="/post/Images/script_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="normalizing" class="section level4">
<h4>Normalizing</h4>
<p>Since the pictures are different sizes I will need to normalize them. I can do this using the resize function with a for loop. The result is 12 pictures that are 28 by 28 pixels.</p>
<pre class="r"><code>for(i in 1:12){
  mypic[[i]] &lt;- resize(mypic[[i]], 28,28)
}</code></pre>
<p><br></p>
</div>
<div id="reshaping-the-data" class="section level4">
<h4>Reshaping the Data</h4>
<p>I then reshape the data using array_reshape from the Keras Package. What this does is creates a matrix with each vector containing 28 by 28 by 3 or 2,352 rows. This will help us run the data through the model.</p>
<pre class="r"><code>for(i in 1:12){
  mypic[[i]] &lt;- array_reshape(mypic[[i]], c(28,28,3))
}
str(mypic)</code></pre>
<pre><code>## List of 12
##  $ : num [1:28, 1:28, 1:3] 0.965 0.971 0.94 0.933 0.936 ...
##  $ : num [1:28, 1:28, 1:3] 0.467 0.478 0.502 0.52 0.529 ...
##  $ : num [1:28, 1:28, 1:3] 0.792 0.804 0.816 0.82 0.82 ...
##  $ : num [1:28, 1:28, 1:3] 0.773 0.773 0.78 0.776 0.779 ...
##  $ : num [1:28, 1:28, 1:3] 0.522 0.522 0.522 0.525 0.525 ...
##  $ : num [1:28, 1:28, 1:3] 0.11 0.11 0.11 0.098 0.098 ...
##  $ : num [1:28, 1:28, 1:3] 1 1 1 1 1 1 1 1 1 1 ...
##  $ : num [1:28, 1:28, 1:3] 0.783 0.804 0.831 0.841 0.852 ...
##  $ : num [1:28, 1:28, 1:3] 1 1 1 1 1 1 1 1 1 1 ...
##  $ : num [1:28, 1:28, 1:3] 1 1 1 1 1 1 1 1 1 1 ...
##  $ : num [1:28, 1:28, 1:3] 1 1 1 1 1 1 1 1 1 1 ...
##  $ : num [1:28, 1:28, 1:3] 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p><br></p>
</div>
<div id="rbind-the-data" class="section level4">
<h4>Rbind the data</h4>
<p>We now have 10 rows with 2,352 columns.</p>
<pre class="r"><code>trainx &lt;- NULL
for(i in 1:5){ #first 5 planes 6th one for testing
  trainx&lt;- rbind(trainx, mypic[[i]])
}
for(i in 7:11){ #12 used for testing
  trainx &lt;- rbind(trainx, mypic[[i]])
}
str(trainx)</code></pre>
<pre><code>##  num [1:10, 1:2352] 0.965 0.467 0.792 0.773 0.522 ...</code></pre>
<p><br></p>
</div>
<div id="testing-images" class="section level4">
<h4>Testing Images</h4>
<p>I am going to use picture 6 and picture 12 for testing. One is a plane the other is a car.</p>
<pre class="r"><code>testx &lt;- rbind(mypic[[6]], mypic[[12]])</code></pre>
<p><br></p>
</div>
<div id="dependent-variable" class="section level4">
<h4>Dependent Variable</h4>
<p>0 is a plane and 1 is a car. If you remember the first 6 pictures were planes and the last 6 were cars. But we used one of each for testing. So the first 5 are planes or “0” and the last 5 are cars or “1”. The test was a plane first and a car second.</p>
<pre class="r"><code>trainy &lt;- c(0,0,0,0,0,1,1,1,1,1)
testy &lt;- c(0,1)</code></pre>
<p><br></p>
</div>
<div id="one-hot-encoding" class="section level4">
<h4>One Hot Encoding</h4>
<pre class="r"><code>trainLabels &lt;- to_categorical(trainy)
testlabels &lt;- to_categorical(testy)</code></pre>
<p><br></p>
</div>
<div id="building-neural-network" class="section level4">
<h4>Building Neural Network</h4>
<pre class="r"><code>model &lt;- keras_model_sequential()
model %&gt;%
  layer_dense(units = 256, activation = &quot;relu&quot;, input_shape = c(2352))%&gt;%
  layer_dense(units = 128, activation = &quot;relu&quot;)%&gt;%
  layer_dense(units = 2, activation = &quot;softmax&quot;)
summary(model)</code></pre>
<pre><code>## ___________________________________________________________________________
## Layer (type)                     Output Shape                  Param #     
## ===========================================================================
## dense_1 (Dense)                  (None, 256)                   602368      
## ___________________________________________________________________________
## dense_2 (Dense)                  (None, 128)                   32896       
## ___________________________________________________________________________
## dense_3 (Dense)                  (None, 2)                     258         
## ===========================================================================
## Total params: 635,522
## Trainable params: 635,522
## Non-trainable params: 0
## ___________________________________________________________________________</code></pre>
<pre class="r"><code>model%&gt;%
  compile(loss = &quot;binary_crossentropy&quot;,
          optimizer = optimizer_rmsprop(),
          metrics= c(&quot;accuracy&quot;))

history &lt;- model%&gt;%
  fit(trainx,
      trainLabels,
      epochs = 30,
      batch_size = 32,
      validation_split = 0.2)
plot(history)</code></pre>
<p><img src="/post/Images/script_files/figure-html/unnamed-chunk-12-1.png" width="672" /> <br></p>
</div>
<div id="running-model" class="section level4">
<h4>Running Model</h4>
<p>Accuracy was 100%.</p>
<pre class="r"><code>model %&gt;% evaluate(trainx, trainLabels)</code></pre>
<pre><code>## $loss
## [1] 0.01313561
## 
## $acc
## [1] 1</code></pre>
<p><br></p>
</div>
<div id="confusion-matrix" class="section level4">
<h4>Confusion Matrix</h4>
<p>We accurately classified all the planes and all the cars.</p>
<pre class="r"><code>pred &lt;- model %&gt;%
  predict_classes(trainx)

table(Predicted = pred, Actual = trainy)</code></pre>
<pre><code>##          Actual
## Predicted 0 1
##         0 5 0
##         1 0 5</code></pre>
<p><br></p>
<pre class="r"><code>prob &lt;- model %&gt;%
  predict_proba(trainx)
options(scipen = 99999)
cbind(prob, Predicted = pred, Actual = trainy)</code></pre>
<pre><code>##                                Predicted Actual
##  [1,] 0.9844468236 0.015553225         0      0
##  [2,] 0.9913114309 0.008688590         0      0
##  [3,] 0.9971514344 0.002848601         0      0
##  [4,] 0.9861415029 0.013858485         0      0
##  [5,] 0.9775083065 0.022491703         0      0
##  [6,] 0.0002601415 0.999739826         1      1
##  [7,] 0.0119622266 0.988037825         1      1
##  [8,] 0.0335208401 0.966479182         1      1
##  [9,] 0.0163330473 0.983666897         1      1
## [10,] 0.0045293802 0.995470643         1      1</code></pre>
<p><br></p>
</div>
<div id="how-does-it-do-on-images-it-hasnt-seen" class="section level4">
<h4>How does it do on images it hasn’t seen?</h4>
<p>It also accuratly identifies the images.</p>
<pre class="r"><code>model %&gt;%
  evaluate(testx, testlabels)</code></pre>
<pre><code>## $loss
## [1] 0.01635947
## 
## $acc
## [1] 1</code></pre>
<pre class="r"><code>pred &lt;- model%&gt;% predict_classes(testx)

table(Predicted = pred, Actual = testy)</code></pre>
<pre><code>##          Actual
## Predicted 0 1
##         0 1 0
##         1 0 1</code></pre>
</div>
</div>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/supervised-learning" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">supervised learning</a>
   </li>
  
   <li class="list">
     <a href="/tags/caret" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">caret</a>
   </li>
  
   <li class="list">
     <a href="/tags/machine-learning" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">machine learning</a>
   </li>
  
   <li class="list">
     <a href="/tags/models" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">models</a>
   </li>
  
   <li class="list">
     <a href="/tags/keras" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">keras</a>
   </li>
  
   <li class="list">
     <a href="/tags/tutorial" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">tutorial</a>
   </li>
  
   <li class="list">
     <a href="/tags/tensorflow" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">tensorflow</a>
   </li>
  
</ul>
<div class="mt6">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "www-shockleysblog-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </main>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/post/keras_ctg/script/">Google -- Thank you for giving us Tensorflow and Keras...</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/reuters/reutersnewswire/">Neural Network on the Reuters Data Set!</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/mnist/script/">Neural Networks - Super Cool!</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/randomforest/rfscript/">Complete Review of the Random Forest Package</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/glmnet/glmnet/">What?  Hypertune Using glmnet and Caret by Max Kuhn?  Pass it along.</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/naivebayes/naivebayes/">Naive Bayes Model in R.</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/caretcompare/caret_compare/">Easy way to compare multiple models</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/roc/roc/">The ROC Curve - Is it a Mine or a Rock? - Pick your Sensitivity</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/dplyr/test/">If you&#39;re considering learning R start with Dplyr and work your way from there!</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/slack/slackblog/">An Easier Way to Communicate on Projects (good bye email)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/showdown/showdown/">Showdown:  Random Forest vs Regression on EPA MPG Dataset</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/kmeans/kmeans/">Can the k means algorithm correctly identify a flower by its petal length and width alone?</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/weather_post/mkdown/">How many sunny days are followed by cloudy days in Seattle on any given year?</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/website/rvest_tables_tutorial/">Tutorial on Web Scraping (Basic) - Wiki Tables</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/regex/untitled/">To Regex or to Not?</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="/" >
    &copy; 2018 Chris&#39;s Data Blog
  </a>
    <div>


  <a href="fb.me/astronomerforfun" class="link-transition facebook link dib z-999 pt3 pt0-l mr2" title="Facebook link">
    <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

  </a>







</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
