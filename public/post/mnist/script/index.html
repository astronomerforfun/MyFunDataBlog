<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Chris&#39;s Data Blog  | Neural Networks - Super Cool!</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.49.2" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.e08a958ae3e530145318b6373195c765.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="Neural Networks - Super Cool!" />
<meta property="og:description" content="Basic Review of Neural Network using Mnist Data by Chris Shockley" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/mnist/script/" /><meta property="article:published_time" content="2018-11-16T10:58:08-04:00"/>
<meta property="article:modified_time" content="2018-11-16T10:58:08-04:00"/>

<meta itemprop="name" content="Neural Networks - Super Cool!">
<meta itemprop="description" content="Basic Review of Neural Network using Mnist Data by Chris Shockley">


<meta itemprop="datePublished" content="2018-11-16T10:58:08-04:00" />
<meta itemprop="dateModified" content="2018-11-16T10:58:08-04:00" />
<meta itemprop="wordCount" content="1364">



<meta itemprop="keywords" content="supervised learning,caret,machine learning,models,boston,tutorial," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Neural Networks - Super Cool!"/>
<meta name="twitter:description" content="Basic Review of Neural Network using Mnist Data by Chris Shockley"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  
  
  <header class="cover bg-top" style="background-image: url('/images/neuralfrontpage.jpeg');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      Chris&#39;s Data Blog
    </a>
    <div class="flex-l items-center">
      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/contact/" title="Contact page">
              Contact
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/post/" title="Posts page">
              Posts
            </a>
          </li>
          
        </ul>
      
      


  <a href="fb.me/astronomerforfun" class="link-transition facebook link dib z-999 pt3 pt0-l mr2" title="Facebook link">
    <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

  </a>








    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Neural Networks - Super Cool!</h1>
        
          <h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
            Basic Review of Neural Network using Mnist Data by Chris Shockley
          </h2>
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  <article class="flex-l flex-wrap justify-between mw8 center ph3 ph0-l">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Neural Networks - Super Cool!</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2018-11-16T10:58:08-04:00">November 16, 2018</time>
    </header>

    <main class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><div id="objective" class="section level4">
<h4>Objective:</h4>
<p>I am really into building models. I bought a book by Rick Scavetta. A Deep Learning Expert. I am going to blog my exercises to share and also so I can remember them.</p>
<p>The first exercise is building a simple Neural Network where I’ll train a model of handwritten numbers using the famous mnist dataset, which is a total of 70,000 handwritten digits from High School Students and those at the Census Bureau. I will use 60,000 digits for training the model and 10,000 to test the model on.</p>
</div>
<div id="history" class="section level4">
<h4>History</h4>
<p>Neural Networks are a branch of AI. It’s not as scarry as it sounds, by the way. I’ll explain that later. Basically in the 60’s people were interested in whether or not Machines could learn (think Chess or Checkers). By the 1990’s programmers had developed the Random Forest Models and the like, which did a very good job. But after that interest in Machine Learning fell off so to speak. It wasn’t until recently with the development of Neural Networks that interest and investment took off again. And with good reason. These models could not only memorize the rules, say of Chess, but also react to an opponents moves. They could also solve problems that were less cut and dry of those in simple classification. Like being able to look at a face and determine the age of a person. And now of course we use the technology for self driving cars and the like. I imagine it will continue to deliver but wouldn’t at all be surprised if the technology dissapoints again at some time in the future.</p>
</div>
<div id="mnist-dataset" class="section level4">
<h4>Mnist Dataset</h4>
<p>This a glimpse at the number 5 in the dataset. You can see that there are slight individual differences in the handwriting.</p>
<div class="figure">
<img src="/images/mnist5.jpg" />

</div>
</div>
<div id="basic-procedure" class="section level4">
<h4>Basic Procedure</h4>
<p>How this works is that this dataset is a 3 Dimensional Tensor. Or in other words a matrix of 28 x 28 pixels with a value ranging from 0-255 for the brightness of the individual pixel. Below you will see a picture of what each tensor looks like. Basically if the pixel has a value that will be based on a 0-255 brightness range. If there is no information in that pixel it will be a ‘0’. I will explain the right hand column shortly.</p>
<p><img src="/images/matrixmnist.jpeg" /> <br></p>
</div>
<div id="package-and-data-download" class="section level4">
<h4>Package and Data Download</h4>
<p>Here I am loading the keras package and setting up the data set, which is also built into the keras package.</p>
<pre class="r"><code>library(keras)
mnist &lt;- suppressMessages(dataset_mnist())
c(c(train_images, train_labels), c(test_images, test_labels)) %&lt;-% mnist</code></pre>
<p><br></p>
</div>
<div id="example-image" class="section level4">
<h4>Example Image</h4>
<p>Below you will see image number 1 of the 60,000 in the training set.</p>
<pre class="r"><code>digit &lt;- train_images[1,,]
plot(as.raster(digit, max = 255))</code></pre>
<p><img src="/post/mnist/script_files/figure-html/plot-1.png" width="672" /> <br></p>
</div>
<div id="structure-of-the-data" class="section level4">
<h4>Structure of The Data</h4>
<p>This is more of a double check. There are 60,000 images in Training Set and 10,000 in the Test Set.</p>
<pre class="r"><code>str(train_images)</code></pre>
<pre><code>##  int [1:60000, 1:28, 1:28] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<pre class="r"><code>str(test_images)</code></pre>
<pre><code>##  int [1:10000, 1:28, 1:28] 0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p><br></p>
</div>
<div id="reshape-and-normalize" class="section level4">
<h4>Reshape and Normalize</h4>
<p>The matrix above where you saw the number ‘8’. That is what I am doing here with the array_reshape call. I am also adding a step where I am normalizing the pixel brightness from 0-255 to 0-1, by dividing it by 255. This makes it easier and faster for the network to run through its iterations.</p>
<pre class="r"><code>train_images &lt;- array_reshape(train_images, c(60000, 28*28))
test_images &lt;- array_reshape(test_images, c(10000, 28*28))

train_images &lt;- train_images/255
test_images &lt;- test_images/255</code></pre>
<p><br></p>
</div>
<div id="one-hot-encoding" class="section level4">
<h4>One Hot Encoding</h4>
<p>Train Labels and Test Labels is what the number actually is. Basically we are going to input the images in matrix/tensor form and then we will at the end of the network have the corresponding number. This tells the network what number is. See diagram. I also printed the first ten rows of the output matrix. You can see each row contains 0’s and one “1”, which corresponds to the number that row is.</p>
<div class="figure">
<img src="/images/neuraloutput.jpg" />

</div>
<pre class="r"><code>train_labels &lt;- to_categorical(train_labels)
test_labels &lt;- to_categorical(test_labels)
head(train_labels, 10)</code></pre>
<pre><code>##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
##  [1,]    0    0    0    0    0    1    0    0    0     0
##  [2,]    1    0    0    0    0    0    0    0    0     0
##  [3,]    0    0    0    0    1    0    0    0    0     0
##  [4,]    0    1    0    0    0    0    0    0    0     0
##  [5,]    0    0    0    0    0    0    0    0    0     1
##  [6,]    0    0    1    0    0    0    0    0    0     0
##  [7,]    0    1    0    0    0    0    0    0    0     0
##  [8,]    0    0    0    1    0    0    0    0    0     0
##  [9,]    0    1    0    0    0    0    0    0    0     0
## [10,]    0    0    0    0    1    0    0    0    0     0</code></pre>
<p><br></p>
<p>So now we’re goint to start building out the Neural Network. This will be a dense neural network with two layers. Two layers is pretty basic and simple. I will be adding more layers down the road. Here’s a picture of what’s going on with this code.</p>
<p>There are 512 Neurons in the first layer, which is 2 to the power of 9 (2 to the power of something helps processing speed) and I also want to run this Neural Network on my laptop. The second layer has to do with the output layer, which is the 10 possible numbers (the one hot encoding I did in the section above.)</p>
<div class="figure">
<img src="/images/hiddenlayer.jpg" />

</div>
<pre class="r"><code>network &lt;- keras_model_sequential()%&gt;%
  layer_dense(units = 512, activation = &quot;relu&quot;,
              input_shape = 28*28)%&gt;%
  layer_dense(units = 10, activation = &quot;softmax&quot;)</code></pre>
<p><br></p>
</div>
<div id="summary-of-network" class="section level4">
<h4>Summary of Network</h4>
<p>We can see that I have 401,920 parameters in the first layer and 5,130 in the second for a total of 407,050. That’s a lot of connecting the dots. Most Neural Networks have 10’s of millions.</p>
<pre class="r"><code>summary(network)</code></pre>
<pre><code>## ___________________________________________________________________________
## Layer (type)                     Output Shape                  Param #     
## ===========================================================================
## dense_1 (Dense)                  (None, 512)                   401920      
## ___________________________________________________________________________
## dense_2 (Dense)                  (None, 10)                    5130        
## ===========================================================================
## Total params: 407,050
## Trainable params: 407,050
## Non-trainable params: 0
## ___________________________________________________________________________</code></pre>
<p><br></p>
</div>
<div id="metrics" class="section level4">
<h4>Metrics</h4>
<p>There are quite a few optimizers but one of the most frequently used is rmsprop. I am also going to pick a few metrics so we can see how the network does when it runs. Since this is a categorical problem (is it a 0-9?) we will use categrical_crossentropy. We will also use accuracy. We will see this played out on the graph when we run the model.</p>
<pre class="r"><code>network %&gt;%
  compile(
    optimizer = &quot;rmsprop&quot;,
    loss = &quot;categorical_crossentropy&quot;,
    metrics = c(&quot;accuracy&quot;)
  )</code></pre>
<p><br></p>
</div>
<div id="time-to-run-the-neural-network" class="section level4">
<h4>Time to run the Neural Network</h4>
<p>We are going to do 5 epochs,which means we’re going to run this data through the system 5x (we could do it hundreds of times but we run the risk of it memorizing the data, or overfitting). Below you can see that the accuracy is increased each time we run through the system (or at each epoch) and the loss is decreased.</p>
<pre class="r"><code>history &lt;- network%&gt;%
  fit(train_images, train_labels,epochs = 5, batch_size = 128)
plot(history)</code></pre>
<p><img src="/post/mnist/script_files/figure-html/unnamed-chunk-7-1.png" width="672" /> <br></p>
</div>
<div id="results" class="section level4">
<h4>Results:</h4>
<p>Based on the Neural Network our accuracy is 98.15%. Not bad but we could do better by adding a Convulation Network, which I will do in another post. This is the basics.</p>
<pre class="r"><code>network %&gt;%
  evaluate(test_images, test_labels)</code></pre>
<pre><code>## $loss
## [1] 0.06465204
## 
## $acc
## [1] 0.9824</code></pre>
<p><br></p>
</div>
<div id="but-what-about-data-the-network-hasnt-seen" class="section level4">
<h4>But what about Data the Network hasn’t seen?</h4>
<p>True test. Below you can see the output of the predicted test set for the first 10 rows. Below that you can see how many we misclassified out of 10,000. Which was 185. Not bad at all but not as good as we can do. Rick Scavetta in his course said that we were able to get these results 20 years ago. We can do 10x better by adding a couple more layers, but I’ll need to set up a GPU for that, which I will do – eventually.</p>
<pre class="r"><code>network %&gt;% predict_classes(test_images[1:10,])</code></pre>
<pre><code>##  [1] 7 2 1 0 4 1 4 9 5 9</code></pre>
<pre class="r"><code>predictions &lt;- network%&gt;%
  predict_classes(test_images)
actual &lt;- mnist$test$y
sum(predictions != actual)</code></pre>
<pre><code>## [1] 176</code></pre>
<p><br></p>
</div>
<div id="conclusion" class="section level4">
<h4>Conclusion</h4>
<p>This is a great tool. I understand there are a ton of business applications, especially for operations management. I am looking forward to continuing Scavettas course and learning more about Neural Networks.</p>
</div>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/supervised-learning" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">supervised learning</a>
   </li>
  
   <li class="list">
     <a href="/tags/caret" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">caret</a>
   </li>
  
   <li class="list">
     <a href="/tags/machine-learning" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">machine learning</a>
   </li>
  
   <li class="list">
     <a href="/tags/models" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">models</a>
   </li>
  
   <li class="list">
     <a href="/tags/boston" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">boston</a>
   </li>
  
   <li class="list">
     <a href="/tags/tutorial" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">tutorial</a>
   </li>
  
</ul>
<div class="mt6">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "www-shockleysblog-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </main>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/post/randomforest/rfscript/">Complete Review of the Random Forest Package</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/glmnet/glmnet/">What?  Hypertune Using glmnet and Caret by Max Kuhn?  Pass it along.</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/keras_ctg/script/">Google -- Thank you for giving us Tensorflow and Keras...</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/naivebayes/naivebayes/">Naive Bayes Model in R.</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/caretcompare/caret_compare/">Easy way to compare multiple models</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/roc/roc/">The ROC Curve - Is it a Mine or a Rock? - Pick your Sensitivity</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/slack/slackblog/">An Easier Way to Communicate on Projects (good bye email)</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/showdown/showdown/">Showdown:  Random Forest vs Regression on EPA MPG Dataset</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/kmeans/kmeans/">Can the k means algorithm correctly identify a flower by its petal length and width alone?</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/weather_post/mkdown/">How many sunny days are followed by cloudy days in Seattle on any given year?</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/website/rvest_tables_tutorial/">Tutorial on Web Scraping (Basic) - Wiki Tables</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/regex/untitled/">To Regex or to Not?</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/post/melt/melt/">Why Melt and Cast When You Can Recast?</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="/" >
    &copy; 2018 Chris&#39;s Data Blog
  </a>
    <div>


  <a href="fb.me/astronomerforfun" class="link-transition facebook link dib z-999 pt3 pt0-l mr2" title="Facebook link">
    <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

  </a>







</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
